#!/usr/bin/env bash
#This script is used to reestablish the predefined docker cgroup on boot

#Read the arguments
for ARGUMENT in "$@"
do
   KEY=$(echo $ARGUMENT | cut -f1 -d=)

   KEY_LENGTH=${#KEY}
   VALUE="${ARGUMENT:$KEY_LENGTH+1}"

   export "$KEY"="$VALUE"
done

while true
do
  if [ -d "/sys/fs/cgroup/memory/docker" ]; then
   echo $memory_limit_bytes > "/sys/fs/cgroup/memory/docker/memory.limit_in_bytes"
   echo $memory_soft_limit_bytes > "/sys/fs/cgroup/memory/docker/memory.soft_limit_in_bytes"
   echo $cpu_quota > "/sys/fs/cgroup/cpu/docker/cpu.cfs_quota_us"
   break
  else
   echo "Docker cgroup not yet created"
  fi
  sleep 1
done

while true
do
    sleep 1
done